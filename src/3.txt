#include <SPI.h>
#include <TFT_eSPI.h>
TFT_eSPI tft = TFT_eSPI();

String action = "";

TaskHandle_t touch_handle;
void touch(void *params)
{
  Serial.println("task created");
  uint16_t x, y, z, xr, yr;
  int status;

  for (;;)
  {
    // Check if screen is being touched
    status = analogRead(8);
    if (status == 0)
    {
      z = tft.getTouchRawZ();
      tft.getTouch(&x, &y, 600);
      tft.getTouchRaw(&xr, &yr);
      Serial.printf("\nx: %d, y: %d | xr: %d, yr: %d | z: %d", x, y, xr, yr, z);
      vTaskDelay(10);
    }
    else
    {
      vTaskDelay(25);
    }
  }
}

void setup(void)
{
  delay(5000);
  Serial.begin(115200);
  Serial.println("\n\nStarting...");

  tft.init();
  tft.setRotation(1);

  uint16_t calData[5] = {140, 4015, 210, 4063, 7};
  tft.setTouch(calData);
  // https://github.com/PaulStoffregen/XPT2046_Touchscreen
  // jak będą problemy z wykrywaniem dotyku

  xTaskCreate(touch, "touch", 10024, NULL, 1, &touch_handle);

  Serial.println("Running...");
}

void loop()
{
}
